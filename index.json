[{"categories":null,"content":"Aqui estou anotando sobre os passos para criar as chamadas Golden Images para VM, usando Cloudbase-Init e Cloud-Init. O objetivo é automatizar ao máximo a implantação de VMs (Virtual Machines) em ambientes como o Proxmox (que uso no meu homelab) ou outros IaaS que suportem o padrão Cloud-Init. Também pode ser útil para o dia-a-dia, quando você precisa de um sistema pré-configurado. Esta imagem será pré-configurada e “generalizada”, permitindo que a primeira inicialização seja totalmente automatizada pela mídia de configuração (configdrive/cloud-init ISO), permitindo deploy em segundos de novas VMs. A primeira coisa que vamos precisar fazer é criar uma primeira instalação do nosso sistema operacional, que será depois transformado em imagem base para todas as VMs posteriores. Vamos começar com o Windows. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:0:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#"},{"categories":null,"content":" PreparandoAqui vamos criar nosso disco e VM do zero. Vamos ter processos detalhados de como funciona para Windows e Linux. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:1:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#preparando"},{"categories":null,"content":" Criando Disco VirtualAqui vou optar por utilizar o formato de disco .qcow2. Apesar de ser levemente menos performático que utilizar uma imagem do tipo raw (dados puros .img), eles fornecem alguns recursos que na minha opinião compensam o tradeoff. bash qemu-img create -f qcow2 -F qcow2 win2k22.qcow2 20G qemu-img: Binário do Qemu responsável por gerenciar imagens de disco. create: Comando para criar uma nova imagem de disco. -f qcow2: Define o formato como QCOW2 (otimizado para virtualização). win2k22.qcow2: Caminho do novo disco que será usado pela VM. 20G: Define o tamanho máximo da nova imagem (Por enquanto, precisamos apenas do menor espaço necessário) O Windows Server 2022 costuma usar pouco mais de 10GB de armazenamento, então 20G é mais que o necessário. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:2:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#criando-disco-virtual"},{"categories":null,"content":" Definindo e Inicializando VMUsaremos o virt-install (interface de linha de comando para KVM/QEMU) para definir e iniciar a nova VM, que servirá de base para nossa golden image, anexando o disco de sistema e o .iso de instaçação. Você também pode utilizar o virt-manager para fazer o procedimento pela interface gráfica, basta se atentar a todas as configurações. No exemplo a seguir, vamos criar um host Windows. bash sudo virt-install \\ --name win2k22-golden-base \\ --memory 4096 \\ --vcpus 2 \\ --boot uefi \\ --disk path=./iso/SERVER_EVAL_x64FRE_en-us.iso,device=cdrom,bus=sata \\ --disk path=./iso/virtio-win-0.1.285.iso,device=cdrom,bus=sata \\ --disk path=./win2k22.qcow2,format=qcow2,bus=scsi \\ --os-variant win2k22 \\ --network network=default,model=virtio \\ --controller type=scsi,model=virtio-scsi --name: Nome da VM. --boot uefi: Garante o boot via UEFI (necessário para a maioria dos templates recentes). --disk path=...,bus=scsi: Anexa o disco do sistema que criamos (win2k22.qcow2). scsi aumenta significativamente a performance de disco. --disk path=...,device=cdrom: Anexa o disco de instalação do Windows (SERVER_EVAL_x64FRE_en-us.iso) como CD-ROM e, adicionalmente, o disco contendo os drivers do VirtIO (virtio-win-0.1.285.iso), que pode sempre ser encontrado em (https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso). Vamos falar mais dele mais tarde. --os-variant win2k22: Indica o tipo de sistema que será instalado, para o libvirt selecionar as melhores configurações padrão que não foram especificadas aqui. --network network=default,model=virtio: Indica o adaptador de network que será usado, o libvirt costuma vir com um padrão default que utiliza o método NAT. Utilize sempre que possível o modelo virtio pois ele oferece melhor performance. --controller type=scsi,model=virtio-scsi: (Importante) No meu caso precisei especificar o controlador SCSI, pois no meu caso, com um modelo diferente do virtio-scsi, o sistema não reconheceu os drivers na hora da instalação. Atente-se a isso. Ao executar o comando, uma janela deve ser inicializada seguido do boot da VM. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:3:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#definindo-e-inicializando-vm"},{"categories":null,"content":" Instalação e Configuração do SistemaApós iniciar a VM, o sistema deve automaticamente prosseguir para o boot do CDROM anexado. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#instalação-e-configuração-do-sistema"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#windows"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#instalação-do-sistema-e-drivers-virtio"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#cloudbase-init"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#cloudbase-initconf"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#unattendxml"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#remover-partição-recovery-se-existir"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#opcional-configurações-extras"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#limpeza-e-otimização-da-imagem"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#toques-finais"},{"categories":null,"content":" WindowsProssiga normalmente até a hora de selecionar o disco de instalação, o que você achar estranho, pois não vai aparecer nenhum disco rígido na lista. Essa é a hora que o cdrom do VirtIO entra em jogo. Instalação do Sistema e Drivers VirtIOPara obter um bom nível de desempenho, instalaremos os Drivers Windows VirtIO durante a instalação do Windows. Esses passos são recomendados pelo guia de melhores práticas do Proxmox (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices). Siga as etapas do instalador até chegar à seleção de tipo de instalação onde você precisa selecionar “Personalizado (avançado)” Agora clique em “Load driver” para instalar os drivers VirtIO para disco rígido e rede. Disco rígido: Navegue até a unidade de CD onde você montou o driver VirtIO e selecione a pasta “vioscsi\\2k22\\amd64” e confirme. Selecione o “Red Hat VirtIO SCSI pass-through controller” e clique em seguida para instalá-lo. Agora você deve conseguir ver seu disco. Rede: Repita os passos acima (clique de novo em “Load driver”, etc.) e selecione a pasta “NetKVM\\w10\\amd64”, confirme e selecione “Redhat VirtIO Ethernet Adapter” e prossiga. Balloon de Memória: Novamente, repita os passos mas dessa vez selecione a pasta “Balloon\\w10\\amd64”, e então “VirtIO Balloon Driver” e installe também. Com esses três drivers você deve estar pronto para rodar uma VM de Windows com o melhor desempenho. Agora siga normalmente com a instalação do Windows até visualizar a área de trabalho. Não se preocupe com credenciais de senhas e informações pessoais, pois tudo isso será removido na versão final, apenas coloque uma senha para acesso por enquanto. Dica: Evite a criação da partição Recovery se puder, pois mais pra frente ela irá atrapalhar. Vou dedicar uma área mostrando como se livrar dela mais tarde, então isso não é obrigatório agora. Ao conseguir acesso ao seu sistema, vá até o cdrom do VirtIO que deve estar montado, e instale o restante dos drivers. Basta executar o binário na raíz do cd chamado virtio-guest-tools-win.exe e seguir com a instalação normalmente. Cloudbase-InitO Cloudbase-Init é o equivalente do Windows ao popular Cloud-init para Linux; ele é um agente de software de código aberto projetado para automatizar e realizar a configuração inicial de máquinas virtuais (VMs) Windows quando elas são implantadas em ambientes de nuvem (como OpenStack) ou virtualização (como KVM/QEMU, Hyper-V, VMware). Sua função principal é processar metadados específicos do ambiente (fornecidos via Config Drive, serviço HTTP ou outra fonte) durante o primeiro boot pós-clonagem/deployment. Esses metadados permitem que o Cloudbase-Init execute tarefas essenciais de provisionamento, como configurar o hostname, injetar chaves SSH, definir senhas de administrador, expandir volumes de disco e executar scripts de usuário (userdata), garantindo que a VM esteja pronta para uso imediato sem intervenção manual. No nosso caso, vamos estar utilizando o método configdrive para a disponibilização desses metadados, vamos nos aprofundar mais nisso quando chegar a hora. Por enquanto precisamos instalar o serviço do cloudbase-init. Baixe o instalador (https://cloudbase.it/cloudbase-init/#download) e realize a instalação normalmente, não será necessário escolher nada além as opções pré-marcadas. Após a instalação, o serviço já deve estar pronto com os arquivos do serviço disponibilizados no local C:\\Program Files\\Cloudbase Solutions\\Cloudbase-Init\\conf. Você vai ter dois arquivos de atenção maior, são eles cloudbase-init.conf e Unnatend.xml. Vamos fazer algumas customizações neles. cloudbase-init.confO cloudbase-init é o agente que interage com o Config Drive e configura a VM durante o primeiro boot pós-clonagem. É importante garantir que ele execute os plugins desejados (como definir nome da máquina, senha e estender volumes). Você pode usar o template a seguir: ini [DEFAULT] username=Administrator groups=Administrators inject_user_password=true bsdtar_path=C:\\Program Files\\Cloudba","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:4:1","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#sysprep"},{"categories":null,"content":" Gerando a Golden ImageUsamos o qemu-img convert para converter o disco preparado em sua versão final, aplicando compressão (-c) para reduzir o tamanho do arquivo final. bash sudo qemu-img convert -O qcow2 -c -p \u003csua_imagem\u003e \u003cdestino_da_golden_image\u003e -O qcow2: Formato de saída. -c: Compacta os dados da imagem (reduzindo o tamanho final). \u003csua_imagem\u003e: O disco de origem (preparado com Sysprep). \u003cdestino_da_golden_image\u003e: Destino da Golden Image final. Apenas por precaução, vamos também mudar a imagem para Apenas Leitura, pois ela nunca precisará ser alterada. bash chmod 444 \u003ccaminho_da_sua_golden_image\u003e ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:5:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#gerando-a-golden-image"},{"categories":null,"content":" Injetando metadados em nova VM (ConfigDrive)Conforme mencionado, o Cloudbase-Init tem a capacidade de injetar metadados essenciais (como senha de administrador, hostname, chaves SSH e usuários) em cada nova VM criada a partir da sua Golden Image. Embora existam vários métodos para fornecer esses dados (HTTP, serviços de metadados de nuvem, etc.), para fins de teste em um ambiente KVM/QEMU, utilizaremos o método do Config Drive (CD-ROM). Este método prático consiste em anexar um disco virtual (ISO) à VM no momento do launch. Este disco, formatado com a estrutura de metadados necessária (padrão OpenStack), é lido pelo Cloudbase-Init no primeiro boot, garantindo que a VM seja configurada automaticamente com os parâmetros dinâmicos especificados. O cloud-init lê o disco rotulado de CONFIG-2, e procura pelo exato arquivo /openstack/latest/meta_data.json na inicialização da máquina em busca de metadados. Vamos criar uma nova pasta configdrive para gerar esse conteúdo. bash mkdir -p configdrive/openstack/latest/ Dentro dessa pasta deverá ser armazenado o arquivo meta_data.json com o seguinte conteúdo. meta_data.json json { \"uuid\": \"12345678-1234-1234-1234-123456789abc\", \"hostname\": \"VM-TESTE\", \"admin_pass\": \"MinhaSenha123!\" } uuid: Identificador da VM, útil em casos de virtualização em núvem. hostname: Hostname da nova máquina. admin_pass: Senha do usuário root/Administrator. Agora só precisamos criar uma imagem .iso. bash genisoimage -output configdrive.iso -volid CONFIG-2 -joliet -rock configdrive genisoimage: O programa principal que cria a imagem ISO 9660. No ArchLinux ele pertence ao pacote cdrkit. -output configdrive.iso: Define o nome e caminho do arquivo de saída. Neste caso, o arquivo gerado na pasta atual e será chamado configdrive.iso. -joliet: Habilita extensões Joliet. Isso é importante para sistemas Windows, pois permite o uso de nomes de arquivo mais longos (até 64 caracteres) e caracteres Unicode, além de garantir compatibilidade com sistemas operacionais modernos. -rock: Habilita as extensões Rock Ridge. Essencial para preservar permissões e metadados de sistemas de arquivos UNIX/Linux (como nomes de arquivos longos e case-sensitive), garantindo que a estrutura de diretórios (openstack/latest/) seja mantida corretamente. configdrive: É o diretório de origem. O genisoimage empacotará todo o conteúdo deste diretório (e subdiretórios, como configdrive/openstack/latest/meta_data.json) dentro da imagem ISO. Então criamos um arquivo ISO chamado configdrive.iso com o rótulo CONFIG-2, usando o conteúdo do diretório configdrive, e aplicando as extensões Joliet (para Windows) e Rock Ridge (para preservar a estrutura de metadados). Este ISO será, então, usado como o Config Drive para injetar nossas configurações no Cloudbase-Init. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:6:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#injetando-metadados-em-nova-vm-configdrive"},{"categories":null,"content":" TestandoPara testar, criamos um novo disco a partir desta Golden Image (usando copy-on-write) e a inicializamos com o nosso Config Drive de testes. 1. Criar disco bash qemu-img create -f qcow2 \\ -b \u003clocal_sua_golden_image\u003e \\ -F qcow2 \\ vm-teste-1.qcow2 64G 3. Criar Nova VM bash sudo virt-install \\ --name test-vm\\ --memory 4096 \\ --vcpus 4 \\ --boot uefi \\ --disk path=./vm-teste-1.qcow2,format=qcow2,bus=scsi \\ --disk path=\u003cseu_configdrive_iso\u003e,device=cdrom,bus=sata \\ --os-variant \u003csistema_da_vm\u003e \\ --network network=default,model=virtio \\ --controller type=scsi,model=virtio-scsi Se tudo der certo, na primeira inicialização, o Windows rodará o OOBE, o cloudbase-init detectará o Config Drive, aplicará o novo hostname, a nova senha, e fará o resize do disco para 64G. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:7:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#testando"},{"categories":null,"content":" ConclusãoCom a Golden Image finalizada e o processo de provisionamento via Config Drive validado, você estabeleceu uma base robusta para o deploy de ambientes Windows em seu ambiente. O uso do Cloud-Init transforma um processo demorado e manual em uma rotina automatizada e padronizada. Agora, a implantação de um novo sistema requer apenas a criação de um novo disco copy-on-write a partir da imagem mestra e a definição de um novo meta_data.json. Isso economiza tempo e garante a consistência em todas as suas novas máquinas, físicas ou virtuais. ","date":"2025-12-11","objectID":"/posts/criando-golden-images-para-vm/:8:0","series":null,"tags":null,"title":"Deploy de Sistemas/VMs com Golden Images","uri":"/posts/criando-golden-images-para-vm/#conclusão"},{"categories":["guide","notes"],"content":"O CMakeConfig.txt é um arquivo de configuração utilizado pelo CMake para definir como um projeto deve ser construído, incluindo definições de variáveis, opções de compilação, diretórios de inclusão e outras configurações necessárias. É uma boa escolha especialmente para fazer projetos multiplataforma em C/C++. ","date":"2024-05-23","objectID":"/posts/utilizando-o-cmake/:0:0","series":null,"tags":["C++"],"title":"Utilizando o CMake","uri":"/posts/utilizando-o-cmake/#"},{"categories":["guide","notes"],"content":" Criando um projeto com o CMakeO primeiro passo para criar um projeto utilizando o CMake é criando um arquivo CMakeConfig.txt na raiz do projeto. txt cmake_minimum_required(VERSION 3.8) project(\"Program\") add_executable(${PROJECT_NAME} main.cpp) Agora vamos criar um arquivo main.cpp c++ #include \u003ciostream\u003e int main() { std::cout \u003c\u003c \"Hello World!\" \u003c\u003c std::endl; return 0; } ","date":"2024-05-23","objectID":"/posts/utilizando-o-cmake/:1:0","series":null,"tags":["C++"],"title":"Utilizando o CMake","uri":"/posts/utilizando-o-cmake/#criando-um-projeto-com-o-cmake"},{"categories":["guide","notes"],"content":" ConfiguraçãoO CMake usa um processo chamado “configuração” para criar todos os arquivos necessários para compilar um projeto. Durante essa fase, ele lê as configurações do projeto (normalmente do arquivo CMakeLists.txt) e ajusta tudo conforme o gerador escolhido pelo usuário, como makefiles para o GNU Make ou projetos para o Visual Studio. Isso garante que o projeto seja configurado corretamente para o sistema e ferramentas de desenvolvimento usados, facilitando a compilação e gerenciamento das dependências. Vamos gerar uma configuração pro nosso projeto: shell $ cmake -B build/ -G \"Visual Studio 17 2022\" . -B \u003cdiretório\u003e : Diretório que os arquivos de build serão colocados. -G \u003cgerador\u003e : Gerador alvo que serão feitas os arquivos de projeto, como por exemplo “Visual Studio 17 2022” para windows ou “Unix Makefiles” para linux. Você pode consultar todos os geradores disponíveis através do comando cmake --help. Caso não definida essa flag, um gerador padrão definido pelo CMake será utilizado. . : Diretório onde está o CMakeConfig.txt ","date":"2024-05-23","objectID":"/posts/utilizando-o-cmake/:1:1","series":null,"tags":["C++"],"title":"Utilizando o CMake","uri":"/posts/utilizando-o-cmake/#configuração"},{"categories":["guide","notes"],"content":" CompilandoPara compilar o projeto vamos utilizar o comando: shell $ cmake --build build/ --config Debug --build \u003cdiretório\u003e : Diretório que os arquivos de build estão. --config \u003cconfig\u003e : Tipo de preset de build, como por exemplo: “Debug” ou “Release”, caso esta flag não seja especificada, o cmake utilizará o preset “Debug” por padrão. ","date":"2024-05-23","objectID":"/posts/utilizando-o-cmake/:1:2","series":null,"tags":["C++"],"title":"Utilizando o CMake","uri":"/posts/utilizando-o-cmake/#compilando"},{"categories":["notes"],"content":"Durante a compilação de um código em C++, o compilador altera os nomes das funções e símbolos no binário. Esse processo é chamado de name mangling e garante que cada símbolo tenha um identificador único. Isso é necessário, por exemplo, para suportar a sobrecarga de funções. Em C, os nomes das funções são mantidos como no código original. Para evitar essa renomeação (name mangling) em C++, utilizamos o modificador extern \"C\". Esse modificador instrui o compilador a não alterar os nomes dos símbolos, mantendo-os como no código original, o que é útil ao criar bibliotecas que precisam ser usadas em outros projetos e linguagens. ","date":"2024-05-22","objectID":"/posts/extern-c/:0:0","series":null,"tags":["C++"],"title":"Modificador extern \"C\"","uri":"/posts/extern-c/#"},{"categories":["notes"],"content":" Exemplo práticoapp.cpp c++ #include \u003ciostream\u003e #include \u003ctypeinfo\u003e #include \"c_file.h\" int main() { func(); return 0; } Ao compilar o arquivo com g++ -c app.cpp e inspecionar o binário resultante com nm app.o, observamos o seguinte: shell $ g++ -c app.cpp $ nm app.o 0000000000000000 b .bss 0000000000000000 d .data 0000000000000000 p .pdata 0000000000000000 r .rdata 0000000000000000 r .rdata$zzz 0000000000000000 t .text 0000000000000000 r .xdata U __main U _Z4funcv 0000000000000000 r _ZNSt8__detail30__integer_to_chars_is_unsignedIjEE 0000000000000001 r _ZNSt8__detail30__integer_to_chars_is_unsignedImEE 0000000000000002 r _ZNSt8__detail30__integer_to_chars_is_unsignedIyEE 0000000000000000 T main Aqui, o nome da nossa função func foi renomeado para _Z4funcv no binário. Agora, vamos modificar o código para incluir extern \"C\": c++ #include \u003ciostream\u003e #include \u003ctypeinfo\u003e extern \"C\" { #include \"c_file.h\" } int main() { func(); return 0; } Ao recompilar e inspecionar o binário novamente, veremos: shell $ g++ -c app.cpp $ nm app.o 0000000000000000 b .bss 0000000000000000 d .data 0000000000000000 p .pdata 0000000000000000 r .rdata 0000000000000000 r .rdata$zzz 0000000000000000 t .text 0000000000000000 r .xdata U __main 0000000000000000 r _ZNSt8__detail30__integer_to_chars_is_unsignedIjEE 0000000000000001 r _ZNSt8__detail30__integer_to_chars_is_unsignedImEE 0000000000000002 r _ZNSt8__detail30__integer_to_chars_is_unsignedIyEE U func 0000000000000000 T main Agora, o nome da nossa função func permanece inalterado no binário. Isso demonstra como extern \"C\" impede o name mangling, mantendo os nomes das funções como no código original. Essa técnica é especialmente útil ao escrever bibliotecas que precisam ser utilizadas em outros projetos e linguagens, garantindo a compatibilidade e a integridade dos nomes das funções. ","date":"2024-05-22","objectID":"/posts/extern-c/:1:0","series":null,"tags":["C++"],"title":"Modificador extern \"C\"","uri":"/posts/extern-c/#exemplo-prático"}]